plugins {
    id 'java'
    id 'application'
    id 'com.google.cloud.tools.jib' version '2.1.0'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'io.vertx:vertx-web:3.8.3'
}

mainClassName = 'es.andrewazor.demo.Main'

def baseImage = 'registry.access.redhat.com/ubi8/openjdk-11';
def baseImageTag = '1.3-3.1593114401';
def version = '0.3.0';

jib {
    from {
        image = baseImage + ':' + baseImageTag
    }
    to {
        image = "quay.io/andrewazores/vertx-fib-demo"
        tags = [version, 'latest']
    }
    dockerClient {
        executable = '/usr/bin/podman'
    }
    container {
        creationTime = 'USE_CURRENT_TIMESTAMP'
        ports = [
        '8080',
        '9093',
        ]
        jvmFlags = [
            '-Dcom.sun.management.jmxremote.port=9093',
            '-Dcom.sun.management.jmxremote.rmi.port=9093',
            '-Dcom.sun.management.jmxremote.ssl=false',
            '-Dcom.sun.management.jmxremote.authenticate=true',
            '-Dcom.sun.management.jmxremote.password.file=/app/resources/jmxremote.password',
            '-Dcom.sun.management.jmxremote.access.file=/app/resources/jmxremote.access',
            '-Dcom.sun.management.jmxremote.autodiscovery=true',
        ]
    }
    extraDirectories {
        paths = 'src/main/extras'
        permissions = [
            '/app/resources/jmxremote.password': '400',
            '/app/resources/jmxremote.access': '400',
        ]
    }
}

applicationDefaultJvmArgs = jib.container.jvmFlags
